<launch>

  <include file="$(find pr2_machine)/$(env ROBOT).machine" />

  <node name="collision_free_controllers_spawner"
        pkg="pr2_controller_manager" type="spawner" output="screen"
        args="--wait-for=calibrated both_arms_controller" />

  <node name="collision_free_controllers_killer"
        pkg="pr2_controller_manager" type="unspawner" output="screen"
        args="r_arm_controller l_arm_controller" />

  <!-- Arms -->
  <rosparam command="load" file="$(find pr2_arm_navigation_actions)/config/pr2_both_arms_controllers.yaml" />

 <!-- Nodes on top of the controllers -->
  <group ns="both_arms_controller">
    <node name="joint_trajectory_action_node"
          pkg="joint_trajectory_action" type="joint_trajectory_action" />
  </group>

  <!-- load planning_environment -->
  <include file="$(find pr2_arm_navigation_actions)/launch/environment_server.launch"/>
   <param name="environment_server/use_collision_map" type="bool" value="false" />

  <!-- load filter -->
  <node pkg="trajectory_filter_server" name="two_arm_trajectory_filter" type="trajectory_filter_server" output="screen">
    <rosparam command="load" file="$(find pr2_arm_navigation_actions)/config/collision_free_control_filter_config.yaml"/>
    <rosparam command="load" file="$(find pr2_arm_navigation_config)/config/joint_limits.yaml"/>
  </node>


  <node pkg="collision_free_arm_trajectory_controller" name="collision_free_arm_trajectory_controller"
        type="collision_free_arm_trajectory_controller" output="screen">
   <param name="traj_action_name" type="string" value="both_arms_controller/joint_trajectory_action" />
   <param name="group_name" type="string" value="both_arms" />
   <remap from="filter_trajectory" to="trajectory_filter/filter_trajectory" />	
   <remap from="get_robot_state" to="environment_server_right_arm/get_robot_state" />
   <remap from="get_execution_safety" to="environment_server_right_arm/get_execution_safety" />
   <remap from="get_trajectory_validity" to="environment_server_right_arm/get_trajectory_validity" />
  </node>

  <!-- load ik -->
  <include file="$(find pr2_arm_navigation_kinematics)/launch/pr2_ik_rarm_node.launch"/>
  <include file="$(find pr2_arm_navigation_kinematics)/launch/pr2_ik_larm_node.launch"/>

   <!-- Map Server, Localization -->
   <node name="map_server" pkg="map_server" type="map_server" args="$(find sbpl_two_arm_planner_node)/maps/blank.pgm 0.020" />
   <include file="$(find pr2_navigation_global)/amcl_node.xml" />

</launch>
